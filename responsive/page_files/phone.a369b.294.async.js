 var new_z = ""; var force_ct_source_detection = false; var win_chr; var charmap = unescape("%u0402%u0403%u201A%u0453%u201E%u2026%u2020%u2021%u20AC%u2030%u0409%u2039%u040A%u040C%u040B%u040F%u0452%u2018%u2019%u201C%u201D%u2022%u2013%u2014%u0000%u2122%u0459%u203A%u045A%u045C%u045B%u045F%u00A0%u040E%u045E%u0408%u00A4%u0490%u00A6%u00A7%u0401%u00A9%u0404%u00AB%u00AC%u00AD%u00AE%u0407%u00B0%u00B1%u0406%u0456%u0491%u00B5%u00B6%u00B7%u0451%u2116%u0454%u00BB%u0458%u0405%u0455%u0457"); function code2char(code) { if (code >= 0xC0 && code <= 0xFF) { return String.fromCharCode(code - 0xC0 + 0x0410); } if (code >= 0x80 && code <= 0xBF) { win_chr++; return charmap.charAt(code - 0x80); } return String.fromCharCode(code); } function winToUnicode(str) { win_chr = 0; str = unescape(str); var res = ""; for(var i = 0; i < str.length; i++) { res = res + code2char(str.charCodeAt(i)); } return res; } function utf8_decode(str) { var string = ""; var i = 0; var c = c1 = c2 = 0; str = unescape(str); while ( i < str.length ) { c = str.charCodeAt(i); if (c < 128) { string += String.fromCharCode(c); i++; } else if((c > 191) && (c < 224)) { c2 = str.charCodeAt(i+1); string += String.fromCharCode(((c & 31) << 6) | (c2 & 63)); i += 2; } else { c2 = str.charCodeAt(i+1); c3 = str.charCodeAt(i+2); string += String.fromCharCode(((c & 15) << 12) | ((c2 & 63) << 6) | (c3 & 63)); i += 3; } } return string; } function convertEncoding(str) { var result = winToUnicode(str); if ( 0 < win_chr ) { result = utf8_decode(str); } return result; } function _uGC(l,n,s) { if (!l || l=="" || !n || n=="" || !s || s=="") { return "-"; } var i,i2,i3,c="-"; i=l.indexOf(n); i3=n.indexOf("=")+1; if (i > -1) { i2=l.indexOf(s,i); if (i2 < 0) { i2=l.length; } c=l.substring((i+i3),i2); } return c; } function _getQuerystring(string, key, default_) { if ( default_==null ) { default_=""; } var search = unescape(string); if ( search == "" ) { return default_; } search = search.substr(1); search = search.replace("?","&"); var params = search.split("&"); for (var i = 0; i < params.length; i++) { var pairs = params[i].split("="); if(pairs[0] == key) { return pairs[1]; } } return default_; } function _setCookie (name, value, expires, path, domain, secure, dont_escape) { value = ((dont_escape) ? value : escape(value));document.cookie = name + "=" + value + ((expires) ? "; expires=" + expires : "") + ((path) ? "; path=" + path : "") + ((domain) ? "; domain=" + domain : "") + ((secure) ? "; secure" : ""); } function _getCookie(name) { var cookie = " " + document.cookie; var search = " " + name + "="; var setStr = null; var offset = 0; var end = 0; if (cookie.length > 0) { offset = cookie.indexOf(search); if (offset != -1) { offset += search.length; end = cookie.indexOf(";", offset); if (end == -1) { end = cookie.length; } setStr = unescape(cookie.substring(offset, end)); } } return(setStr); } function _deleteCookie(name, path, domain) { _setCookie(name, null, new Date(0), path, domain); }String.prototype.translit = (function(){ var L = { 'А':'A','а':'a','Б':'B','б':'b','В':'V','в':'v','Г':'G','г':'g', 'Д':'D','д':'d','Е':'E','е':'e','Ё':'Yo','ё':'yo','Ж':'Zh','ж':'zh', 'З':'Z','з':'z','И':'I','и':'i','Й':'Y','й':'y','К':'K','к':'k', 'Л':'L','л':'l','М':'M','м':'m','Н':'N','н':'n','О':'O','о':'o', 'П':'P','п':'p','Р':'R','р':'r','С':'S','с':'s','Т':'T','т':'t', 'У':'U','у':'u','Ф':'F','ф':'f','Х':'Kh','х':'kh','Ц':'Ts','ц':'ts', 'Ч':'Ch','ч':'ch','Ш':'Sh','ш':'sh','Щ':'Sch','щ':'sch','Ъ':'"','ъ':'"', 'Ы':'Y','ы':'y','Ь':"'",'ь':"'",'Э':'E','э':'e','Ю':'Yu','ю':'yu', 'Я':'Ya','я':'ya' }, r = '', k; for (k in L) r += k; r = new RegExp('[' + r + ']', 'g'); k = function(a){ return a in L ? L[a] : ''; }; return function(){ return this.replace(r, k); }; })(); function replace_phone(el_id, html_text) { var el = null; if ( "@" == el_id[0] ) { rdst = el_id.substring(1); clearrdst = rdst.replace(/ /g, ""); clearrdst = clearrdst.replace(/\+/g, ""); clearrdst = clearrdst.replace(/\-/g, ""); clearrdst = clearrdst.replace(/\(/g, ""); clearrdst = clearrdst.replace(/\)/g, ""); clearrdst = clearrdst.replace(/\,/g, ""); clearrdst = clearrdst.replace(/\‒/g, ""); clearrdst = clearrdst.replace(/\–/g, ""); clearrdst = clearrdst.translit(); class_name = "ct_lr_"+clearrdst; jQuery("body *:contains('"+rdst+"')").add('body').contents().each(function(){ if ( this.nodeType == Node.TEXT_NODE && -1 != jQuery(this).text().indexOf(rdst)) { jQuery(this).parent().addClass(class_name); } }); jQuery('.'+class_name).attr('prev_num'+clearrdst, rdst); jQuery('.'+class_name).each(function(){ prev_num = jQuery(this).attr('prev_num'+clearrdst); var ct_lazy = jQuery(this).html(); ct_lazy = ct_lazy.split(prev_num).join(html_text); jQuery(this).html(ct_lazy); jQuery(this).attr('prev_num'+clearrdst, html_text); }); } else if ( "." == el_id[0] ) { jQuery(el_id).html(html_text); } else { jQuery(el_id).html(html_text); } } function initGeoCity() { var ct_gc = _getCookie("ct_gc"); if (ct_gc != null){ ct_geoCity = ct_gc; } else { var ct_gcs = document.createElement('script'); ct_gcs.type = 'text/javascript'; var prot = (document.location.protocol === 'https:' ? 'https:' : 'http:'); ct_gcs.src = prot+'//calltracking.ru/geoip/init_geo_city.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ct_gcs, s); } } function isGaLoaded(num_tries) { if ( typeof(ct_geoCity) == "undefined" ) { if ( 10 > num_tries ) { setTimeout("isGaLoaded(" + (num_tries+1) + ");", 500); } } else { umtz_data = { ct_source: "", ct_medium: "", ct_term: "", ct_campaign: "", ct_content: "", ct_gclid: "", ct_yclid: "" }; umtz_data.ct_source = _getQuerystring(location.search, "utm_source","-").toLowerCase(); umtz_data.ct_medium = _getQuerystring(location.search, "utm_medium","-").toLowerCase(); umtz_data.ct_campaign = _getQuerystring(location.search, "utm_campaign","-").toLowerCase(); umtz_data.ct_term = convertEncoding(_getQuerystring(location.search, "utm_term","-")).toLowerCase(); umtz_data.ct_content = convertEncoding(_getQuerystring(location.search, "utm_content","-")).toLowerCase(); umtz_data.ct_gclid = _getQuerystring(location.search, "gclid","-"); if ( umtz_data.ct_gclid != "-" ) { umtz_data.ct_source = "google"; umtz_data.ct_medium = "cpc"; } var z = _uGC(document.cookie, "__utmz=", ";"); if ( _uGC(document.cookie, "__imz=", ";") != "-" || force_ct_source_detection ){ var z = _uGC(document.cookie, "__imz=", ";"); } if ( "" == umtz_data.ct_term || "-" == umtz_data.ct_term ) { if ( -1 != document.referrer.indexOf("mail.ru") && "-" != _getQuerystring(document.referrer, "q","-") ) { var term = convertEncoding(_getQuerystring(document.referrer, "q","-")).toLowerCase(); } if ( -1 != document.referrer.indexOf("google") ) { var term = convertEncoding(_getQuerystring(document.referrer, "q","-")).toLowerCase(); } if ( -1 != document.referrer.indexOf("yandex") ) { var term = convertEncoding(_getQuerystring(document.referrer, "text","-")).toLowerCase(); } umtz_data.ct_term = term; } if ( "-" != umtz_data.ct_source || "-" != umtz_data.ct_medium || "-" != umtz_data.ct_campaign ) { var new_z = "utmcsr="+umtz_data.ct_source+"|utmccn="+umtz_data.ct_campaign+"|utmcmd="+umtz_data.ct_medium+"|utmctr="+umtz_data.ct_term+"|utmcct="+umtz_data.ct_content+"|utmgclid="+umtz_data.ct_gclid; } else if ( z != "" && z != "-" ) { var new_z = ""; } else if ( "" != document.referrer && -1 == document.referrer.indexOf("http://togas.ru") ) { var referrer = document.referrer.match(/^(https?\:)\/\/(www.)?(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/i); var new_z = "utmcsr="+referrer[3]+"|utmccn=(referral)|utmcmd=referral|utmctr=-|utmcct=-"; if ( -1 != document.referrer.indexOf("mail.ru") && "-" != _getQuerystring(document.referrer, "q","-") ) { var new_z = "utmcsr=mail.ru|utmccn=(organic)|utmcmd=organic|utmctr="+term+"|utmcct=-"; } if ( -1 != document.referrer.indexOf("google") ) { var new_z = "utmcsr=google|utmccn=(organic)|utmcmd=organic|utmctr="+term+"|utmcct=-"; } if ( -1 != document.referrer.indexOf("market.yandex") ) { var new_z = "utmcsr=market.yandex.ru|utmccn=(organic)|utmcmd=organic|utmctr="+term+"|utmcct=-"; } else if( -1 != document.referrer.indexOf("maps.yandex") ) { var new_z = "utmcsr=maps.yandex.ru|utmccn=(organic)|utmcmd=organic|utmctr="+term+"|utmcct=-"; } else if ( -1 != document.referrer.indexOf("yandex") ) { var new_z = "utmcsr=yandex|utmccn=(organic)|utmcmd=organic|utmctr="+term+"|utmcct=-"; } } else { var new_z = "utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)|utmctr=-|utmcct=-"; } if ( new_z != "" && new_z != "-" ) { var milisecs = new Date().getTime(); var sevenmonth = new Date(milisecs+1000*60*60*24*7); _setCookie("__utmz", new_z , sevenmonth,"/",location.host.replace('www.',''),"", 1); _setCookie("__imz", new_z , sevenmonth,"/",location.host.replace('www.',''),"", 1); } ct_core(); } } var umtz_data; var sorce_id; function ct_core() { umtz_data = { ct_source: "", ct_medium: "", ct_term: "", ct_campaign: "", ct_gclid: "", ct_yclid: "" }; var z = _uGC(document.cookie, "__utmz=", ";"); if ( _uGC(document.cookie, "__imz=", ";") != "-" ){ var z = _uGC(document.cookie, "__imz=", ";"); } umtz_data.ct_source = _uGC(z, "utmcsr=", "|").toLowerCase(); umtz_data.ct_medium = _uGC(z, "utmcmd=", "|").toLowerCase(); umtz_data.ct_term = convertEncoding(_uGC(z, "utmctr=", "|")).toLowerCase(); umtz_data.ct_term_pad = (" "+umtz_data.ct_term+" ").toLowerCase(); umtz_data.ct_campaign = _uGC(z, "utmccn=", "|").toLowerCase(); umtz_data.ct_gclid = _uGC(z, "utmgclid=", "|"); umtz_data.ct_yclid = _getQuerystring(location.search, "yclid","-").toLowerCase(); if ( "-" == umtz_data.ct_yclid) { var ct_yclid = _getCookie("ct_yclid"); if (ct_yclid != null){ umtz_data.ct_yclid = ct_yclid; } } else { var today = new Date(); var milisecs = Date.parse(today+""); var sevenmonth = new Date(milisecs+1000*60*60*24*7); _setCookie("ct_yclid", umtz_data.ct_yclid , sevenmonth,"/",location.host.replace('www.','')); } if ( umtz_data.ct_gclid != "-" ) { umtz_data.ct_source = "google"; umtz_data.ct_medium = "cpc"; } match = false; sorce_id = 0; code = "495"; tel = ""; if (!match && (51867 == ct_geoCity) && ((((-1 != umtz_data.ct_campaign.indexOf('kry')))))) { replace_phone("@+7 (495) 771-3-771","+7 (343) 386-16-63"); match = true; match_static = true; code = "343"; tel = "386-16-63"; sorce_id = 24354; } if (!match && (51867 == ct_geoCity) && ((('organic' == umtz_data.ct_medium)))) { replace_phone("@+7 (495) 771-3-771","+7 (343) 386-18-73"); match = true; match_static = true; code = "343"; tel = "386-18-73"; sorce_id = 24364; } if (!match && (32497 == ct_geoCity) && ((((-1 != umtz_data.ct_campaign.indexOf('kry')))))) { replace_phone("@+7 (495) 771-3-771","+7 (812) 389-27-88"); match = true; match_static = true; code = "812"; tel = "389-27-88"; sorce_id = 24352; } if (!match && (32497 == ct_geoCity) && ((('organic' == umtz_data.ct_medium)))) { replace_phone("@+7 (495) 771-3-771","+7 (812) 389-26-19"); match = true; match_static = true; code = "812"; tel = "389-26-19"; sorce_id = 24362; } if (!match && (23541 == ct_geoCity) && ((((-1 != umtz_data.ct_campaign.indexOf('kry')))))) { replace_phone("@+7 (495) 771-3-771","+7 (495) 645-69-37"); match = true; match_static = true; code = "495"; tel = "645-69-37"; sorce_id = 24350; } if (!match && (23541 == ct_geoCity) && ((((-1 != umtz_data.ct_campaign.indexOf('krg')))))) { replace_phone("@+7 (495) 771-3-771","+7 (495) 645-67-92"); match = true; match_static = true; code = "495"; tel = "645-67-92"; sorce_id = 24356; } if (!match && ((('yandex' == umtz_data.ct_source) && ('organic' == umtz_data.ct_medium)))) { replace_phone("@+7 (495) 771-3-771","+7 (495) 223-68-47"); match = true; match_static = true; code = "495"; tel = "223-68-47"; sorce_id = 24358; } if (!match && ((('google' == umtz_data.ct_source) && ('organic' == umtz_data.ct_medium)))) { replace_phone("@+7 (495) 771-3-771","+7 (495) 223-69-28"); match = true; match_static = true; code = "495"; tel = "223-69-28"; sorce_id = 24360; } } initGeoCity();isGaLoaded(1);